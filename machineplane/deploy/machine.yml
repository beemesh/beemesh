apiVersion: v1
kind: Pod
metadata:
  name: beemesh-machine-bootstrap
  labels:
    app: beemesh-machine
    role: bootstrap
spec:
  restartPolicy: Always
  containers:
    - name: machine
      image: beemesh-machine:latest
      args:
        - "--libp2p-quic-port"
        - "4001"
        - "--podman-socket"
        - "/run/podman/podman.sock"
        - "--disable-scheduling"
      ports:
        - containerPort: 4001
          hostPort: 4001
          protocol: UDP
        - containerPort: 4001
          hostPort: 4001
          protocol: TCP
        - containerPort: 3000
          hostPort: 3000
          protocol: TCP
        - containerPort: 3000
          hostPort: 3000
          protocol: UDP
      volumeMounts:
        - name: podman-socket
          mountPath: /run/podman/podman.sock
        - name: host-proc-cpuinfo
          mountPath: /host-proc/cpuinfo
          readOnly: true
        - name: host-proc-meminfo
          mountPath: /host-proc/meminfo
          readOnly: true
        - name: host-containers-storage
          mountPath: /var/lib/containers/storage
          readOnly: true
  volumes:
    - name: podman-socket
      hostPath:
        path: /run/podman/podman.sock
        type: Socket
    - name: host-proc-cpuinfo
      hostPath:
        path: /proc/cpuinfo
        type: File
    - name: host-proc-meminfo
      hostPath:
        path: /proc/meminfo
        type: File
    - name: host-containers-storage
      hostPath:
        path: /var/lib/containers/storage
        type: Directory
---
apiVersion: v1
kind: Pod
metadata:
  name: beemesh-machine-peer-1
  labels:
    app: beemesh-machine
    role: peer
spec:
  restartPolicy: Always
  containers:
    - name: machine
      image: beemesh-machine:latest
      args:
        - "--disable-rest-api"
        - "--disable-machine-api"
        - "--bootstrap-peer"
        - "/ip4/10.90.0.50/udp/4001/quic-v1"
        - "--podman-socket"
        - "/run/podman/podman.sock"
      volumeMounts:
        - name: podman-socket
          mountPath: /run/podman/podman.sock
        - name: host-proc-cpuinfo
          mountPath: /host-proc/cpuinfo
          readOnly: true
        - name: host-proc-meminfo
          mountPath: /host-proc/meminfo
          readOnly: true
        - name: host-containers-storage
          mountPath: /var/lib/containers/storage
          readOnly: true
  volumes:
    - name: podman-socket
      hostPath:
        path: /run/podman/podman.sock
        type: Socket
    - name: host-proc-cpuinfo
      hostPath:
        path: /proc/cpuinfo
        type: File
    - name: host-proc-meminfo
      hostPath:
        path: /proc/meminfo
        type: File
    - name: host-containers-storage
      hostPath:
        path: /var/lib/containers/storage
        type: Directory

---
apiVersion: v1
kind: Pod
metadata:
  name: beemesh-machine-peer-2
  labels:
    app: beemesh-machine
    role: peer
spec:
  restartPolicy: Always
  containers:
    - name: machine
      image: beemesh-machine:latest
      args:
        - "--disable-rest-api"
        - "--disable-machine-api"
        - "--bootstrap-peer"
        - "/ip4/10.90.0.50/udp/4001/quic-v1"
        - "--podman-socket"
        - "/run/podman/podman.sock"
      volumeMounts:
        - name: podman-socket
          mountPath: /run/podman/podman.sock
        - name: host-proc-cpuinfo
          mountPath: /host-proc/cpuinfo
          readOnly: true
        - name: host-proc-meminfo
          mountPath: /host-proc/meminfo
          readOnly: true
        - name: host-containers-storage
          mountPath: /var/lib/containers/storage
          readOnly: true
  volumes:
    - name: podman-socket
      hostPath:
        path: /run/podman/podman.sock
        type: Socket
    - name: host-proc-cpuinfo
      hostPath:
        path: /proc/cpuinfo
        type: File
    - name: host-proc-meminfo
      hostPath:
        path: /proc/meminfo
        type: File
    - name: host-containers-storage
      hostPath:
        path: /var/lib/containers/storage
        type: Directory
